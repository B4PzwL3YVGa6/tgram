{{ template "header" . }}
{{ template "menu" . }}
<section>
<form  action="{{.path}}" method="post">
	<input name="title"  type="text" placeholder="title, text, 0..255" value="{{.title}}">
	<input name="ogimage" type="text" placeholder="image, link, 0..255" value="{{.ogimage}}">
	<textarea id="mde" name="body">{{.body}}</textarea>
	<input name="tag" type="text" placeholder="tag, without #, alphanum, 0..20" value="{{.tag}}">
    <button type="submit" accesskey="p" >Publish</button>
</form>
</section>
{{if eq .editor 1}}
<section>
<h1>Stats</h1>
<div id="mdestats"></div>
<h1>Preview</h1>
    <div id="preview"></div>
</section>
{{end}}
<section>
	<details>
		<summary>upload image</summary>
		<p>
			<a href="/upload" target="_blank" >upload from file</a>
		</p>		
	</details>
</section>

<script>
	{{if eq .editor 0}}
var simplemde = new InscrybMDE({
    autoDownloadFontAwesome: true,
    autofocus: true,
	autosave: {
		enabled: true,
		uniqueId: "{{.path}}",
		delay: 1000,
	},
	promptURLs: true,
	placeholder: "text, markdown, 10..65536",
	element: document.getElementById("mde"),
    minHeight: "400px",
	spellChecker: false,
});
{{end}}
{{if eq .editor 1}}
var converter = new showdown.Converter()
var mde=document.getElementById("mde")
mde.addEventListener('input', markdownify(mde,'preview'), true)
mde.placeholder = "text, markdown, 10..65536"
mde.minHeight = "400px"

	function markdownify(t,pd) {
console.log(t.value)
document.getElementById(pd).innerHTML=converter.makeHtml(t.value)
Countable.count(t, counter => printStats(counter,t.id+"stats"))
}

	function printStats(c,id) {
var pds = document.getElementById(id)
	pds.innerHTML=c.characters+" characters<br/>"
pds.innerHTML+=c.words+" words<br/>"
pds.innerHTML+=c.paragraphs+" paragraphs<br/>"
pds.innerHTML+=c.sentences+" sentences<br/>"
pds.innerHTML+=c.all+" total characters<br/>"
	}
	{{end}}
</script>

{{ template "footer" . }}